%metadata_section%from json import loads
from sys import path
from pathlib import Path

#Adding root folder to allow import from src
src_path = str(Path(__file__).parent).replace('/destinations/pipeline/%User_folder%','')
path.insert(0, src_path)
path.insert(0, src_path+'/src')

from src.services.workspace.Workspace import Workspace
from src.services.workspace.SecretManager import referencedSecrets%secret_manager_import%

%template_code%

dest_folder = Workspace.get_duckdb_path_on_ppline()

%destination_settings%

print(f'Fetching data from datasource', flush=True)
data = data_source()
print(f"Running the pipeline", flush=True)

try:
    load_info = pipeline.run(data)
    print(load_info, flush=True)
    print('RUN_SUCCESSFULLY', flush=True)
except Exception as err:
    print(f'RUNTIME_ERROR:Runtime Pipeline error: {err}')